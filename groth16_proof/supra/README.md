# Accelerated Groth16 Prover

An accelerated groth16 prover that generates the witness and produces a proof for the `stark verify` circuit.

## Introduction

This leverages a further optimized version of the [circom-witnesscalc](https://github.com/iden3/circom-witnesscalc)
repository to quickly generate the witness, along with a C++/CUDA prover to compute the groth16 proof. 
To make the process faster, some setup needs to be done. To do the setup, you can follow these steps:

```
ulimit -s 32768
sh setup_circuit.sh
```

After the setup is complete, make sure that [snarkjs](https://github.com/iden3/snarkjs) is installed. 
`snarkjs` is used to verify the generated proofs and to export the verification key from the `.zkey` file.

## Proving

You can run
```
sh prove_and_verify.sh
```
to call the prover which will generate the witness and then compute the groth16 proof.
It will create `proof.json` and `public.json` files which will then be input to `snarkjs` along with the verification key to ensure the proof is valid.

## Slight Modification of the Circuit

Due to a functionality limitation in `circom-witnesscalc`, a small portion of the circuit had to be modified 
in order for `circom-witnesscalc` to process it.

[Line 406 of risc0.circom](https://github.com/supranational/risc0-dev3/blob/23ce8a6aa63631d3baf528eed5d1b02041a545c9/groth16_proof/groth16/risc0.circom#L406) was split into 2 lines:
```
var inv_res = inverse(in[0], P);
out <-- inv_res;
```
This modification does not affect the constraints and therefore does not change the witnesses generated. 
To make sure that this is the case, first make sure that [circom](https://github.com/iden3/circom) is installed. 
Then run
```
sh test_witness_generation.sh
```
which will follow risc0's steps to compile the .cpp witness generator for the original circuit and then will 
generate the witnesses using it and compare the generated witnesses 
against the witnesses generated by `circom-witnesscalc` using the modified circuit.
